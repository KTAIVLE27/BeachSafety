{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>해양안전</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="{% static 'img/favicon.ico'%}" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css'%}" rel="stylesheet">
    <link href="{% static 'lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css'%}" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="{% static 'css/bootstrap.min.css'%}" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="{% static 'css/style.css'%}" rel="stylesheet">
</head>

<body>
    <div class="container-fluid position-relative bg-white d-flex p-0">
       
<div id="vmap" style="width:50vw;height:50vh;left:0px;top:0px">
</div> 
<script type="text/javascript" src="http://map.vworld.kr/js/vworldMapInit.js.do?version=2.0
&apiKey=80973894-487D-3977-BA22-621594681047&domain=www.test.com/map.html"></script> 
<script type="text/javascript">

vw.ol3.CameraPosition.center = [14256762.437870322, 4360039.299660016];
vw.ol3.CameraPosition.zoom =8;
                                        //지도의 초기 위치값을 설정

vw.ol3.MapOptions = {
 
  basemapType: vw.ol3.BasemapType.GRAPHIC
, controlDensity: vw.ol3.DensityType.EMPTY
, interactionDensity: vw.ol3.DensityType.BASIC
, controlsAutoArrange: true
, homePosition: vw.ol3.CameraPosition
, initPosition: vw.ol3.CameraPosition
};

let vmap = new vw.ol3.Map("vmap",  vw.ol3.MapOptions); 

var context = JSON.parse('{{ contextjson | escapejs }}');

var latestData = context.score_msg;
var meta = context.meta;
var lon = context.lon;
var lat = context.lat;

//마커찍기
var markerLayer = new vw.ol3.layer.Marker(vmap); 
vmap.addLayer(markerLayer);
//마커 레이어 생성


// 팝업 엘리먼트
var popup = document.getElementById('popup');

// 마커 생성 함수
function createMarker(id, x, y, epsg, title, contents, iconUrl) {
    var markerOption = {
        x: x,
        y: y,
        epsg: epsg,
        title: title,
        contents: contents,
        iconUrl: iconUrl,
        attr: { id: id }
    };
    var marker = markerLayer.addMarker(markerOption);

    // 마커 클릭 이벤트 추가
    marker.on('click', function(evt) {
        popup.innerHTML = contents;
        popup.style.display = 'block';
        popup.style.left = evt.pixel[0] + 'px';
        popup.style.top = evt.pixel[1] + 'px';
    });

    return markerOption;
}

// 마커 상태 업데이트 함수
function updateMarkerIcon(marker, imgUrl) {
    marker.iconUrl = imgUrl;
    markerLayer.removeMarker(marker);
    markerLayer.addMarker(marker);
}

// 여러 마커 추가
var markerData = [
    { id: 'marker1', x: 128.909, y: 37.8, epsg: 'EPSG:4326', title: '마커 1', contents: '마커 1 내용', iconUrl: "{% static 'img/red1.png' %}" },
    { id: 'marker2', x: 129.411, y: 36.597, epsg: 'EPSG:4326', title: '마커 2', contents: '마커 2 내용', iconUrl: "{% static 'img/green1.png' %}" },
    { id: 'marker3', x: 128.631, y: 38.118, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
    { id: 'marker4', x: 126.507, y: 36.305, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
    { id: 'marker5', x: 129.09, y: 37.593, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
    { id: 'marker6', x: 128.601, y: 38.19, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
    { id: 'marker7', x: 129.199, y: 35.178, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
    { id: 'marker8', x: 129.264, y: 35.318, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
    { id: 'marker9', x: 126.409, y: 33.245, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
    { id: 'marker10', x: 129.16, y: 35.158, epsg: 'EPSG:4326', title: '마커 3', contents: '마커 3 내용', iconUrl: "{% static 'img/yellow1.png' %}" },
];

var markers = {};

markerData.forEach(function(marker) {
    markers[marker.id] = createMarker(marker.id, marker.x, marker.y, marker.epsg, marker.title, marker.contents, marker.iconUrl);
});

// 주기적으로 마커 아이콘 업데이트
setInterval(function() {
    Object.keys(markers).forEach(function(id) {
        var newIconUrl = Math.random() > 0.5 ? "{% static 'img/red1.png' %}" : "{% static 'img/green1.png' %}";
        updateMarkerIcon(markers[id], newIconUrl);
    });
}, 5000); // 5초마다 업데이트
</script>





<div class="logo">
<a href="{% url 'home' %}"><img src="{% static 'img/logo.png' %}" style="width:50px; height:50px;" ></i></a>      
</div> 

<div class="nav-buttons">
    
    <form>
        <div class="search-wrapper">
            <input class="control-search" type="search" placeholder="Search">
            <span class="search-button" type="submit">
                <img src="{% static 'img/search_icon.png' %}" alt="Search" style="width: 30px; height: 30px;">
            </span>
        </div>
    </form>

    <a href="{% url 'signin' %}"><img src="{% static 'img/logout_24dp.png' %}"style="width: 40px; height: 40px;"></a>
    <a href="{% url 'myprofile' %}"><img src="{% static 'img/face_24dp.png' %}" style="width: 40px; height: 40px;"></a>  
</div>


<div class="side-buttons">
    <a href="#" class="btn btn-primary" title="119" data-bs-toggle="tooltip" data-bs-placement="left"> <i class="fa fa-phone"></i> </a>
    <a href="#" class="btn btn-primary" title="해군" data-bs-toggle="tooltip" data-bs-placement="left"> <i class="fa fa-anchor"></i> </a>
    <a href="#" class="btn btn-primary" title="모의훈련" data-bs-toggle="tooltip" data-bs-placement="left"> <i class="fa fa-file-alt"></i> </a>
    <a href="#" class="btn btn-primary" title="기상예보" data-bs-toggle="tooltip" data-bs-placement="left"> <i class="fa fa-cloud-sun"></i> </a>                   
</div>
</div>






        <!-- Back to Top -->
        <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'lib/chart/chart.min.js'%}"></script>
    <script src="{% static 'lib/easing/easing.min.js'%}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js'%}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js'%}"></script>
    <script src="{% static 'lib/tempusdominus/js/moment.min.js'%}"></script>
    <script src="{% static 'lib/tempusdominus/js/moment-timezone.min.js'%}"></script>
    <script src="{% static 'lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js'%}"></script>

    <!-- Template Javascript -->
    <script src="{% static 'js/main.js'%}"></script>
</body>


    <p>변수 a의 값은 {{ latest_data.score_msg }}입니다.</p>
    <p>변수 a의 값은 <span id="meta-lon">{{ meta.lon }}</span>입니다.</p>
    


</html>


